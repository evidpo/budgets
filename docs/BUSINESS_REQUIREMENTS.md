# Бизнес-требования проекта "Семейные финансы"

## Версия
Версия: 1.0  
Дата: 2025-09-28  
Источник: PRD — Семейные финансы (MVP, Web‑first)

## 1. Общее описание

Проект "Семейные финансы" — это веб-приложение для управления личными и семейными финансами. Приложение позволяет отслеживать доходы и расходы, управлять бюджетами, контролировать долги и кредиты, а также формировать финансовые отчеты.

### 1.1 Цели проекта

1. Обеспечить быстрое добавление транзакций (≤10 секунд на запись)
2. Организовать совместную работу в «семье» (household) с ролями
3. Предоставить простые и понятные инструменты управления **Бюджетами** с возможностью переноса остатков
4. Реализовать базовые **Отчёты** (общий баланс, по бюджетам, по счетам, доходы/расходы по категориям)
5. Обеспечить импорт данных из CSV (Alzex) с мастером склейки переводов

### 1.2 Метрики успеха

- Доля автокатегоризованных транзакций ≥ 60% в первый месяц
- Время до первой записи ≤ 2 минут с нуля
- 0 критических расхождений в балансах после импорта

## 2. Функциональные требования

### 2.1 Счета (`/accounts`)

**Цель:** Управление финансовыми счетами (банковские счета, наличные, кредиты и т.д.)

**Функции:**
- Просмотр списка счетов с текущими балансами
- Перетаскивание для изменения порядка счетов
- Создание, редактирование и архивация счетов
- Просмотр транзакций по конкретному счету

**Особенности:**
- Баланс рассчитывается как: `начальный_баланс + Σ суммы транзакций по счету`
- Переводы учитываются в балансах (это реальные движения)

### 2.2 Транзакции (`/transactions`)

**Цель:** Учет доходов, расходов и переводов между счетами

**Функции:**
- Создание транзакций трех типов: доход, расход, перевод
- Фильтрация транзакций по различным критериям
- Автокатегоризация транзакций по правилам

**Особенности:**
- Тип транзакции определяется знаком суммы: `amount > 0` = доход, `< 0` = расход
- Переводы хранятся как пара обычных транзакций, связанных общим `transfer_id`
- Переводы не учитываются в доходах/расходах и бюджетах

### 2.3 Бюджеты (`/budgets`)

**Цель:** Планирование и контроль расходов/доходов по различным категориям и периодам

**Функции:**
- Создание бюджетов с различными периодами (неделя, месяц, квартал, год, кастомный)
- Настройка фильтрации транзакций по счетам и/или категориям
- Расчет доступных средств с учетом лимита и фактических трат
- Настройка переноса остатков на следующий период

**Особенности:**
- Бюджет ≠ Счет. Бюджет — расчетный объект (не хранит деньги)
- Переводы исключаются из расчетов бюджета
- Поддержка пересечения фильтров (и категории, и счета)

### 2.4 Категории (`/categories`)

**Цель:** Классификация транзакций для аналитики и бюджетирования

**Функции:**
- Создание иерархической структуры категорий
- Назначение иконок и цветов категориям
- Поиск и фильтрация категорий

**Особенности:**
- Поддержка древовидной структуры с полем `path` вида `Root:Child:Sub`
- Поддержка поддерева в фильтрах

### 2.5 Долги (`/debts`)

**Цель:** Учет займов, кредитов и долговых обязательств

**Функции:**
- Создание записей о долгах
- Связывание с транзакциями
- Расчет текущего остатка по долгам

**Особенности:**
- Остаток = `начальный_баланс + Σ суммы транзакций с привязкой к долгу`
- Получение займа — доход (+), погашение — расход (−)

### 2.6 Правила автокатегоризации (`/rules`)

**Цель:** Автоматическое присвоение категорий транзакциям

**Функции:**
- Создание правил разных типов (по плательщику, регулярным выражениям, паттернам суммы)
- Настройка приоритетов правил
- Применение правил к транзакциям

**Особенности:**
- Приоритеты: плательщик > регулярные выражения > паттерны суммы
- Визуализация применения правил в интерфейсе

### 2.7 Отчеты (`/reports`)

**Цель:** Анализ финансовых данных

**Типы отчетов:**
- Общий баланс (на текущий момент и за период)
- По бюджетам (факт vs лимит)
- По счетам (движение средств)
- Доходы по категориям
- Расходы по категориям

**Особенности:**
- Поддержка экспорта в CSV
- Фильтрация (включая исключение переводов)

### 2.8 Импорт данных (`/import`)

**Цель:** Загрузка финансовых данных из внешних источников

**Функции:**
- Загрузка CSV файлов (спецификация Alzex)
- Автоматическое определение формата
- Сопоставление полей
- Мастер склейки переводов
- Предварительный просмотр и подтверждение импорта

**Особенности:**
- Поддержка отката импорта
- Эвристический алгоритм склейки переводов

## 3. Нефункциональные требования

### 3.1 Производительность
- Поддержка 100k+ транзакций без деградации UX
- Использование индексов, курсорной пагинации и виртуализации списков

### 3.2 Надежность
- Идемпотентность операций создания транзакций
- Возможность отката импорта
- Система версионирования данных

### 3.3 Доступность
- Контрастность ≥ 4.5:1
- Поддержка фокус-стилей
- Таб-навигация

### 3.4 Совместная работа
- Поддержка работы в "семье" (household)
- Разграничение ролей: владелец, редактор, наблюдатель
- Система приглашений

### 3.5 Масштабируемость
- Поддержка планирования заранее (например, "конверты" как отдельный тип счета)
- Возможность расширения функциональности без переделки основной архитектуры

## 4. Ограничения и допущения

### 4.1 Исключения из MVP
- Функция "Конверты" (sinking funds) не входит в MVP, но архитектура позволяет добавить позже без переделок

### 4.2 Технические допущения
- Использование Supabase для аутентификации, базы данных и реалтайм синхронизации
- Использование Next.js для frontend части
- Использование TypeScript для обеспечения типобезопасности

## 5. Приемочные критерии

### 5.1 Транзакции/Переводы
- Перевод A→B на X создает 2 строки с общим `transfer_id`
- Доходы/расходы в отчетах и бюджетах не учитывают переводы

### 5.2 Счета
- Перетаскивание меняет порядок и сохраняется
- Баланс счета меняется сразу после записи транзакции/перевода (realtime)

### 5.3 Бюджеты
- Месячный бюджет с лимитом L=100 и rollover=ON:
  - Август: потрачено 800 → перенос +200
  - Сентябрь: потрачено 1300 → доступно −100 (перенос −100 на октябрь)

### 5.4 Отчеты
- Общий баланс: значение «на сейчас» совпадает с суммой реальных остатков
- "Движение за период" корректно реагирует на чекбокс "исключить переводы"

### 5.5 Импорт CSV
- Мастер склейки корректно находит пары по эвристике
- Подтвержденные пары получают `transfer_id`
- Поддержка отката возвращает предыдущее состояние