# Инструкция по локальному запуску и проверке приложения "Семейные финансы"

## 1. Системные требования

Для локального запуска и проверки приложения "Семейные финансы" необходимы следующие компоненты:

### Минимальные системные требования:
- Операционная система: macOS, Linux или Windows (с WSL2 для Windows)
- Процессор: 2 ядра или выше
- Оперативная память: 4 ГБ или выше
- Свободное место на диске: 2 ГБ

### Программное обеспечение:
- Node.js 18 или выше
- npm 8 или выше (или Yarn)
- Docker Desktop (для локального запуска Supabase)
- Git
- Supabase CLI (для управления локальным Supabase проектом)

## 2. Установка и настройка зависимостей

### Установка Node.js и npm:
1. Посетите сайт [nodejs.org](https://nodejs.org/)
2. Скачайте и установите LTS-версию Node.js (включает npm)
3. Проверьте установку в терминале:
   ```bash
   node --version
   npm --version
   ```

### Установка Git:
1. Для macOS: `brew install git` (если у вас установлен Homebrew) или скачайте с [git-scm.com](https://git-scm.com/)
2. Для Ubuntu/Debian: `sudo apt update && sudo apt install git`
3. Для Windows: скачайте с [git-scm.com](https://git-scm.com/) и установите
4. Проверьте установку:
   ```bash
   git --version
   ```

### Установка Docker:
1. Скачайте и установите Docker Desktop с [docker.com](https://www.docker.com/products/docker-desktop)
2. Запустите Docker Desktop и дождитесь запуска
3. Проверьте установку:
   ```bash
   docker --version
   docker-compose --version
   ```

### Установка Supabase CLI:
1. Для macOS: `brew install supabase/tap/supabase`
2. Для Linux: 
   ```bash
   curl -fsSL https://cli.supabase.com/install.sh | sh
   ```
3. Для Windows: скачайте бинарный файл с [релизов Supabase CLI](https://github.com/supabase/cli/releases)
4. Проверьте установку:
   ```bash
   supabase --version
   ```

## 3. Настройка Supabase проекта

### Клонирование репозитория:
1. Откройте терминал
2. Клонируйте репозиторий проекта:
   ```bash
   git clone <repository-url>
   cd budgets
   ```

### Запуск локального Supabase:
1. Перейдите в директорию проекта:
   ```bash
   cd budgets/supabase
   ```
2. Запустите локальный Supabase:
   ```bash
   supabase start
   ```
   Эта команда:
   - Запустит PostgreSQL базу данных
   - Инициализирует Supabase Auth
   - Применит все SQL миграции из директории `migrations`
   - Запустит Realtime сервис
   - Загрузит демо данные из `seed.sql` (если они есть)

3. После запуска CLI отобразит URL и ключи для подключения. Сохраните их, они понадобятся для настройки переменных окружения.

### Проверка запуска Supabase:
1. Убедитесь, что все сервисы запущены:
   ```bash
   supabase status
   ```
2. Откройте Supabase Studio в браузере по умолчанию:
   ```bash
   supabase db gui
   ```

## 4. Настройка переменных окружения

### Создание файла конфигурации:
1. Перейдите в директорию frontend:
   ```bash
   cd budgets/frontend
   ```
2. Создайте файл с переменными окружения:
   ```bash
   cp .env.local.example .env.local
   ```

### Заполнение переменных окружения:
Откройте файл `.env.local` в редакторе кода и заполните следующие переменные:

```env
# Supabase конфигурация (полученные из supabase start)
NEXT_PUBLIC_SUPABASE_URL=http://127.0.0.1:54321
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key_here

# Дополнительные настройки (по желанию)
NEXT_PUBLIC_APP_NAME=Семейные финансы (локально)
NEXT_PUBLIC_DEFAULT_CURRENCY=EUR
```

**Примечание:** Значения `NEXT_PUBLIC_SUPABASE_URL` и `NEXT_PUBLIC_SUPABASE_ANON_KEY` нужно взять из вывода команды `supabase start`. URL обычно `http://127.0.0.1:54321`, а ключ - это длинная строка, начинающаяся с `eyJhb...`.

## 5. Запуск фронтенд части

### Установка зависимостей:
1. Убедитесь, что вы находитесь в директории `budgets/frontend`
2. Установите зависимости:
   ```bash
   npm install
   ```
   или
   ```bash
   yarn install
   ```

### Запуск в режиме разработки:
1. Запустите приложение в режиме разработки:
   ```bash
   npm run dev
   ```
   или
   ```bash
   yarn dev
   ```

2. Приложение будет доступно по адресу: `http://localhost:3000`

### Сборка для продакшена (опционально):
Если вы хотите собрать приложение для продакшена:
```bash
npm run build
npm start
```

## 6. Запуск Supabase локально

Этот шаг уже был выполнен в разделе 3, но для полноты картины:

### Запуск Supabase:
Если вы еще не запустили Supabase, выполните:
```bash
cd budgets/supabase
supabase start
```

### Остановка Supabase:
Когда нужно остановить локальный Supabase:
```bash
supabase stop
```

### Перезапуск Supabase:
Если нужно перезапустить с чистой базой данных:
```bash
supabase stop
supabase start
```

### Повторное применение миграций:
Если вы внесли изменения в миграции:
```bash
supabase db reset
```

## 7. Проверка работоспособности

### Проверка подключения к Supabase:
1. Убедитесь, что Supabase запущен:
   ```bash
   supabase status
   ```
2. Проверьте, что все сервисы работают корректно

### Проверка запуска фронтенда:
1. Откройте браузер и перейдите на `http://localhost:3000`
2. Проверьте, что страница загружается без ошибок
3. Попробуйте зарегистрироваться или войти в систему
4. Проверьте основные функции:
   - Создание счетов
   - Создание транзакций
   - Просмотр бюджетов
   - Работу с категориями
   - Отчеты

### Проверка реалтайм синхронизации:
1. Откройте приложение в двух разных окнах браузера
2. Создайте транзакцию в одном окне
3. Убедитесь, что изменения отображаются в другом окне в реальном времени

### Проверка консоли браузера:
1. Откройте инструменты разработчика (F12)
2. Перейдите на вкладку Console
3. Убедитесь, что нет ошибок JavaScript
4. Проверьте, что сетевые запросы (вкладка Network) выполняются успешно

## 8. Возможные проблемы и их решения

### Проблема: "Command 'supabase' not found"
**Решение:**
- Убедитесь, что Supabase CLI установлен корректно
- Проверьте, что путь к CLI добавлен в переменную PATH
- Перезапустите терминал

### Проблема: "Port already in use" при запуске Supabase
**Решение:**
- Проверьте, не запущен ли уже Supabase: `supabase status`
- Остановите все экземпляры: `supabase stop`
- Убедитесь, что порты 54321-54323 не используются другими приложениями

### Проблема: "Connection refused" при подключении к Supabase
**Решение:**
- Убедитесь, что Supabase запущен: `supabase start`
- Проверьте, что URL в `.env.local` совпадает с URL из вывода `supabase start`
- Перезапустите Supabase: `supabase stop && supabase start`

### Проблема: "Module not found" при запуске frontend
**Решение:**
- Убедитесь, что вы находитесь в директории `budgets/frontend`
- Удалите `node_modules` и `package-lock.json`: `rm -rf node_modules package-lock.json`
- Переустановите зависимости: `npm install`

### Проблема: "Invalid login credentials"
**Решение:**
- Убедитесь, что Supabase запущен и миграции применены
- Попробуйте зарегистрировать нового пользователя
- Проверьте, что RLS политики настроены корректно

### Проблема: "Network error" при попытке подключения к API
**Решение:**
- Проверьте, что Supabase запущен: `supabase start`
- Убедитесь, что переменные окружения в `.env.local` указаны корректно
- Проверьте, что приложение запущено на `http://localhost:3000`

### Проблема: "Database is not healthy"
**Решение:**
- Остановите Supabase: `supabase stop`
- Удалите локальные данные: `supabase db reset`
- Перезапустите: `supabase start`

### Проблема: "Failed to connect to database"
**Решение:**
- Проверьте, что Docker Desktop запущен
- Убедитесь, что порт 54322 (порт базы данных) не занят
- Перезапустите Docker Desktop и Supabase

### Общие рекомендации по устранению неполадок:
1. Всегда начинайте с проверки статуса Supabase: `supabase status`
2. Проверяйте консоль браузера на наличие ошибок
3. Проверяйте терминал, в котором запущен frontend, наличие ошибок
4. Убедитесь, что все зависимости установлены корректно
5. Перезапустите все сервисы при возникновении проблем: `supabase stop && supabase start`, остановите и перезапустите frontend